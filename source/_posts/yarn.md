---
title: yarn
date: 2020-07-26 17:51:15
tags: ['yarn', 'npm', '包管理']
---

> 每日一言：萧瑟春风今又是，换了人间

# yarn 和 npm 简介

## npm

npm 是众所周知的 node 的包管理工具，常见的使用场景有以下几种：

- 允许用户从NPM服务器下载别人编写的第三方包到本地使用。
- 允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。
- 允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。

但是在实际使用中，却有很明显的缺点：

- npm install 超级慢（一个重要原因是：npm 必须首先遍历所有的项目依赖关系，然后再决定如何生成扁平的node_modules目录结构。npm必须为所有使用到的模块构建一个完整的依赖关系树，这是一个耗时的操作）
- 同一个项目，安装的时候**无法保持一致性**
    ```
        // 比如下面的栗子就表示不同的含义
        "5.0.3",
        "~5.0.3",
        "^5.0.3"

        // “5.0.3”表示安装指定的5.0.3版本
        // “～5.0.3”表示安装5.0.X中最新的版本
        // “^5.0.3”表示安装5.X.X中最新的版本
        // 这就麻烦了，常常会出现同一个项目，有的同事是OK的，有的同事会由于安装的版本不一致出现bug。

    ```
- 安装的时候，包会在同一时间下载和安装，中途某个时候，一个包抛出了一个错误，但是npm会继续下载和安装包。因为npm会把所有的日志输出到终端，有关错误包的错误信息就会在一大堆npm打印的警告中丢失掉，并且你甚至永远不会注意到实际发生的错误。

## yarn

“Yarn是由Facebook、Google、Exponent 和 Tilde 联合推出了一个新的 JS 包管理工具 ，正如官方文档中写的，Yarn 是为了弥补 npm 的一些缺陷而出现的。所以 yarn 有以下优点：

- 速度快
    - 并行安装：无论 npm 还是 Yarn 在执行包的安装时，都会执行一系列任务。npm 是按照队列执行每个 package，也就是说必须要等到当前 package 安装完成之后，才能继续后面的安装。而 Yarn 是同步执行所有任务，提高了性能。
    - 离线模式：如果之前已经安装过一个软件包，用Yarn再次安装时之间从缓存中获取，就不用像npm那样再从网络下载了。
- 安装版本统一：yarn.lock锁定版本（低版本可以通过 npm shrinkwrap 生成npm-shrinkwrap.json 文件，高版本 npm 可以通过 package-lock.json 锁定版本。然而，即使存在npm-shrinkwrap.json这个文件，npm也只会锁定库的版本）
- **更简洁的输出**：npm 的输出信息比较冗长。
- **多注册来源处理**：所有的依赖包，不管他被不同的库间接关联引用多少次，安装这个包时，只会从一个注册来源去装，要么是 npm 要么是 bower, 防止出现混乱不一致。
- **更好的语义化**： yarn改变了一些npm命令的名称，比如 yarn add/remove，感觉上比 npm 原本的 install/uninstall 要更清晰

## 总之

看起来似乎是 yarn 的有点更多？现在的使用中也更广泛

# yarn 的使用

- 参考 [yarn中文文档](https://yarn.bootcss.com/docs/)

## 参考文献

- https://www.jianshu.com/p/254794d5e741
- https://blog.csdn.net/qq_27674439/article/details/93976115
